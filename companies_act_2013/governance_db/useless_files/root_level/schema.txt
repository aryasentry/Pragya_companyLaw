üß± PRAGYA ‚Äî GOVERNANCE-GRADE POSTGRES SCHEMA

(Authoritative Version)

0Ô∏è‚É£ ENUMS (STRICT CONTROL ‚Äî DO NOT SKIP)
Chunk role
CREATE TYPE chunk_role_enum AS ENUM (
  'parent',
  'child'
);

Document type
CREATE TYPE document_type_enum AS ENUM (
  'act',
  'rule',
  'regulation',
  'order',
  'notification',
  'circular',
  'sop',
  'form',
  'guideline',
  'practice_note',
  'commentary',
  'textbook',
  'qa_book'
);

Authority level (LEGAL LAYER)
CREATE TYPE authority_level_enum AS ENUM (
  'statutory',
  'interpretive',
  'procedural',
  'commentary'
);

Relationship types (BIDIRECTIONAL PAIRS)
CREATE TYPE relationship_type_enum AS ENUM (
  'clarifies',
  'proceduralises',
  'proceduralised_by',
  'implements',
  'implemented_by',
  'amends',
  'amended_by',
  'supersedes',
  'superseded_by'
);

Lifecycle status
CREATE TYPE lifecycle_status_enum AS ENUM (
  'DRAFT',
  'ACTIVE',
  'RETIRED'
);

Retrieval priority
CREATE TYPE retrieval_priority_enum AS ENUM (
  '1', -- Act / Rules (standalone)
  '2', -- Circular / Notification (needs Act)
  '3', -- SOP / Forms (procedural only)
  '4'  -- Commentary / Learning
);

1Ô∏è‚É£ CHUNKS ‚Äî IDENTITY (IMMUTABLE)

This table NEVER changes once inserted

CREATE TABLE chunks_identity (
  chunk_id TEXT PRIMARY KEY,

  chunk_role chunk_role_enum NOT NULL,
  parent_chunk_id TEXT REFERENCES chunks_identity(chunk_id),

  document_type document_type_enum NOT NULL,
  authority_level authority_level_enum NOT NULL,
  binding BOOLEAN NOT NULL,

  act TEXT,
  section TEXT,          -- STRING: supports 135(5)(a)
  sub_section TEXT,

  page_number INTEGER,

  created_at TIMESTAMP DEFAULT now(),

  CONSTRAINT parent_child_consistency CHECK (
    (chunk_role = 'parent' AND parent_chunk_id IS NULL)
    OR
    (chunk_role = 'child' AND parent_chunk_id IS NOT NULL)
  )
);

2Ô∏è‚É£ CHUNKS ‚Äî EDITABLE CONTENT (SEMANTIC)

Admin / SME editable

CREATE TABLE chunks_content (
  chunk_id TEXT PRIMARY KEY REFERENCES chunks_identity(chunk_id) ON DELETE CASCADE,

  title TEXT,
  compliance_area TEXT,

  text TEXT,
  summary TEXT,

  updated_by TEXT,
  updated_at TIMESTAMP DEFAULT now()
);

3Ô∏è‚É£ LEGAL ANCHORS (SECTION MAPPING)
CREATE TABLE chunk_legal_anchors (
  chunk_id TEXT REFERENCES chunks_identity(chunk_id) ON DELETE CASCADE,
  anchor TEXT,

  PRIMARY KEY (chunk_id, anchor)
);


Examples:

135

135(5)

135(5)(a)

4Ô∏è‚É£ KEYWORDS (OPTIONAL, TUNABLE)
CREATE TABLE chunk_keywords (
  chunk_id TEXT REFERENCES chunks_identity(chunk_id) ON DELETE CASCADE,
  keyword TEXT,

  PRIMARY KEY (chunk_id, keyword)
);

5Ô∏è‚É£ RELATIONSHIPS GRAPH (CRITICAL)
CREATE TABLE chunk_relationships (
  from_chunk_id TEXT REFERENCES chunks_identity(chunk_id) ON DELETE CASCADE,
  relationship relationship_type_enum NOT NULL,
  to_chunk_id TEXT REFERENCES chunks_identity(chunk_id) ON DELETE CASCADE,

  created_by TEXT,
  created_at TIMESTAMP DEFAULT now(),

  PRIMARY KEY (from_chunk_id, relationship, to_chunk_id)
);


‚úîÔ∏è Can be empty
‚úîÔ∏è Can grow over time
‚úîÔ∏è Graph-safe

6Ô∏è‚É£ RETRIEVAL CONTROLS (LAYER-2 SAFETY)
CREATE TABLE chunk_retrieval_rules (
  chunk_id TEXT PRIMARY KEY REFERENCES chunks_identity(chunk_id) ON DELETE CASCADE,

  priority retrieval_priority_enum NOT NULL,
  requires_parent_law BOOLEAN DEFAULT false,

  allowed_query_types TEXT[] DEFAULT '{}'
);

7Ô∏è‚É£ REFUSAL POLICY (ANTI-HALLUCINATION CORE)
CREATE TABLE chunk_refusal_policy (
  chunk_id TEXT PRIMARY KEY REFERENCES chunks_identity(chunk_id) ON DELETE CASCADE,

  can_answer_standalone BOOLEAN NOT NULL,
  must_reference_parent_law BOOLEAN NOT NULL,
  refuse_if_parent_missing BOOLEAN NOT NULL
);


This is what prevents circular-only answers.

8Ô∏è‚É£ TEMPORAL VALIDITY
CREATE TABLE chunk_temporal (
  chunk_id TEXT PRIMARY KEY REFERENCES chunks_identity(chunk_id) ON DELETE CASCADE,

  date_issued DATE,
  effective_from DATE,
  effective_to DATE
);

9Ô∏è‚É£ LIFECYCLE MANAGEMENT
CREATE TABLE chunk_lifecycle (
  chunk_id TEXT PRIMARY KEY REFERENCES chunks_identity(chunk_id) ON DELETE CASCADE,

  status lifecycle_status_enum NOT NULL,
  retired_on DATE,
  retired_reason TEXT
);

üîü VERSIONING (DOCUMENT HISTORY)
CREATE TABLE chunk_versioning (
  chunk_id TEXT PRIMARY KEY REFERENCES chunks_identity(chunk_id) ON DELETE CASCADE,

  version TEXT NOT NULL,
  supersedes_chunk_id TEXT REFERENCES chunks_identity(chunk_id),
  superseded_by_chunk_id TEXT REFERENCES chunks_identity(chunk_id)
);

1Ô∏è‚É£1Ô∏è‚É£ EMBEDDING TRACKING (VECTOR DB SAFE)
CREATE TABLE chunk_embeddings (
  chunk_id TEXT PRIMARY KEY REFERENCES chunks_identity(chunk_id) ON DELETE CASCADE,

  enabled BOOLEAN NOT NULL,
  model TEXT,
  vector_id TEXT,
  embedded_at TIMESTAMP
);


Rules enforced by code:

parent ‚Üí enabled = false

child ‚Üí enabled = true

1Ô∏è‚É£2Ô∏è‚É£ LINEAGE & INTEGRITY
CREATE TABLE chunk_lineage (
  chunk_id TEXT PRIMARY KEY REFERENCES chunks_identity(chunk_id) ON DELETE CASCADE,

  parent_document_id TEXT,
  checksum TEXT,
  source_hash_verified BOOLEAN
);

1Ô∏è‚É£3Ô∏è‚É£ ADMINISTRATIVE METADATA
CREATE TABLE chunk_administrative (
  chunk_id TEXT PRIMARY KEY REFERENCES chunks_identity(chunk_id) ON DELETE CASCADE,

  issued_by TEXT,
  notification_number TEXT,
  source_type TEXT,
  document_language TEXT
);

1Ô∏è‚É£4Ô∏è‚É£ AUDIT LOG (MANDATORY)
CREATE TABLE chunk_audit (
  chunk_id TEXT PRIMARY KEY REFERENCES chunks_identity(chunk_id) ON DELETE CASCADE,

  uploaded_by TEXT,
  uploaded_at TIMESTAMP,

  approved_by TEXT,
  approved_at TIMESTAMP
);

1Ô∏è‚É£5Ô∏è‚É£ SOURCE REFERENCES
CREATE TABLE chunk_source (
  chunk_id TEXT PRIMARY KEY REFERENCES chunks_identity(chunk_id) ON DELETE CASCADE,

  path TEXT,
  url TEXT
);
